# é¢‘é“æ¶ˆæ¯ç›¸å…³æ¥å£åˆ—è¡¨
æœ¬æ–‡æ¡£ä¸»è¦åˆ—å‡ºé¢‘é“æ¶ˆæ¯ç›¸å…³æ¥å£ã€‚

æœ¬æ–‡æ¡£ä¸­çš„æ¥å£å‡ç¬¦åˆæ¥å£è§„èŒƒï¼Œå¦‚æœ‰ç–‘é—®ï¼Œå»ºè®®å…ˆæŸ¥é˜…[æ¥å£å¼•è¨€](https://developer.kaiheila.cn/doc/reference)ã€‚


|æ¥å£|æ¥å£è¯´æ˜|ç»´æŠ¤çŠ¶æ€|
|--|--|--|
|[/api/v3/message/list](#è·å–é¢‘é“èŠå¤©æ¶ˆæ¯åˆ—è¡¨)|è·å–é¢‘é“èŠå¤©æ¶ˆæ¯åˆ—è¡¨|æ­£å¸¸|
|[/api/v3/message/create](#å‘é€é¢‘é“èŠå¤©æ¶ˆæ¯)|å‘é€é¢‘é“èŠå¤©æ¶ˆæ¯|æ­£å¸¸|
|[/api/v3/message/update](#æ›´æ–°é¢‘é“èŠå¤©æ¶ˆæ¯)|æ›´æ–°é¢‘é“èŠå¤©æ¶ˆæ¯|æ­£å¸¸|
|[/api/v3/message/delete](#åˆ é™¤é¢‘é“èŠå¤©æ¶ˆæ¯)|åˆ é™¤é¢‘é“èŠå¤©æ¶ˆæ¯|æ­£å¸¸|
|[/api/v3/message/reaction-list](#è·å–é¢‘é“æ¶ˆæ¯æŸå›åº”çš„ç”¨æˆ·åˆ—è¡¨)|è·å–é¢‘é“æ¶ˆæ¯æŸä¸ªå›åº”çš„ç”¨æˆ·åˆ—è¡¨|æ­£å¸¸|
|[/api/v3/message/add-reaction](#ç»™æŸä¸ªæ¶ˆæ¯æ·»åŠ å›åº”)|ç»™æŸä¸ªæ¶ˆæ¯æ·»åŠ å›åº”|æ­£å¸¸|
|[/api/v3/message/delete-reaction](#åˆ é™¤æ¶ˆæ¯çš„æŸä¸ªå›åº”)|åˆ é™¤æ¶ˆæ¯çš„æŸä¸ªå›åº”|æ­£å¸¸|

## æ¶ˆæ¯è¯¦æƒ…å‚æ•°è¯´æ˜

| å‚æ•°å        | ç±»å‹    | è¯´æ˜               |
| ------------- | ------- | ------------------ |
| id            | string  | æ¶ˆæ¯ id            |
| type          | int     | æ¶ˆæ¯ç±»å‹           |
| author | map | ä½œè€…çš„ç”¨æˆ·ä¿¡æ¯               |
| content       | string  | æ¶ˆæ¯å†…å®¹           |
| mention       | array   | `@ç‰¹å®šç”¨æˆ·` çš„ç”¨æˆ·IDæ•°ç»„ï¼Œä¸ `mention_info` ä¸­çš„æ•°æ®å¯¹åº” |
| mention_all   | boolean | æ˜¯å¦å«æœ‰ `@å…¨ä½“äººå‘˜` |
| mention_roles | array   | `@ç‰¹å®šè§’è‰²` çš„è§’è‰²IDæ•°ç»„ï¼Œä¸ `mention_info` ä¸­çš„æ•°æ®å¯¹åº” |
| mention_here  | boolean | æ˜¯å¦å«æœ‰ `@åœ¨çº¿äººå‘˜` |
| embeds        | array   | è¶…é“¾æ¥è§£ææ•°æ® |
| attachments | map   | é™„åŠ çš„å¤šåª’ä½“æ•°æ® |
| reactions | array   | å›åº”æ•°æ® |
| quote    | map | å¼•ç”¨æ¶ˆæ¯ |
| mention_info    | map | å¼•ç”¨ç‰¹å®šç”¨æˆ·æˆ–ç‰¹å®šè§’è‰²çš„ä¿¡æ¯ |
| â†³ mention_part | array        | `@ç‰¹å®šç”¨æˆ·` è¯¦æƒ… |
| â†³ mention_role_part | array        | `@ç‰¹å®šè§’è‰²` è¯¦æƒ… |


## è·å–é¢‘é“èŠå¤©æ¶ˆæ¯åˆ—è¡¨

### æ¥å£è¯´æ˜

|åœ°å€|è¯·æ±‚æ–¹å¼|è¯´æ˜|
|--|--|--|
|`/api/v3/message/list`|GET| |

### å‚æ•°åˆ—è¡¨

| å‚æ•°å     | ç±»å‹ | å¿…ä¼  | å‚æ•°åŒºåŸŸ | è¯´æ˜                                              |
| ---------- | ---- | ---- | -------  | ------------------------------------------------- |
| target_id | string  | æ˜¯    | GET | é¢‘é“ id                                       |
| msg_id | string  | å¦    | GET | å‚è€ƒæ¶ˆæ¯ idï¼Œä¸ä¼ åˆ™é»˜è®¤ä¸ºæœ€æ–°çš„æ¶ˆæ¯ id                                        |
| pin    | unsigned int  | å¦   | GET | åªèƒ½ä¸º0æˆ–è€…1ï¼Œæ˜¯å¦æŸ¥è¯¢ç½®é¡¶æ¶ˆæ¯ |
| flag    | string  | å¦   | GET | æŸ¥è¯¢æ¨¡å¼ï¼Œæœ‰ä¸‰ç§æ¨¡å¼å¯ä»¥é€‰æ‹©ã€‚ä¸ä¼ åˆ™é»˜è®¤æŸ¥è¯¢æœ€æ–°çš„æ¶ˆæ¯ |


### æŸ¥è¯¢æ¨¡å¼è¯´æ˜

| æŸ¥è¯¢æ¨¡å¼ |                  è¯¦ç»†è¯´æ˜                  |
| :------: | :----------------------------------------: |
|  before  |  æŸ¥è¯¢å‚è€ƒæ¶ˆæ¯ä¹‹å‰çš„æ¶ˆæ¯ï¼Œä¸åŒ…æ‹¬å‚è€ƒæ¶ˆæ¯ã€‚  |
|  around  | æŸ¥è¯¢ä»¥å‚è€ƒæ¶ˆæ¯ä¸ºä¸­å¿ƒï¼Œå‰åä¸€å®šæ•°é‡çš„æ¶ˆæ¯ã€‚ |
|  after   |  æŸ¥è¯¢å‚è€ƒæ¶ˆæ¯ä¹‹åçš„æ¶ˆæ¯ï¼Œä¸åŒ…æ‹¬å‚è€ƒæ¶ˆæ¯ã€‚  |


### è¿”å›å‚æ•°è¯´æ˜

| å‚æ•°å   | ç±»å‹         | è¯´æ˜                                                         |
| -------- | ------------ | ------------------------------------------------------------ |
| items | array   | æ¶ˆæ¯åˆ—è¡¨                                 |

### è¿”å›ç¤ºä¾‹

```json
{
    "code": 0,
    "message": "æ“ä½œæˆåŠŸ",
    "data": {
        "items": [
            {
                "id": "bac34958-2c73-45c8",
                "type": 1,
                "content": "11111111111111111111111",
                "mention": [
                    "12314**"
                ],
                "mention_all": false,
                "mention_roles": [],
                "mention_here": false,
                "embeds": [
                    {
                        "type": "bili-video",
                        "url": "https://www.bilibili.com/video/XXXXX",
                        "origin_url": "https://www.bilibili.com/video/XXXXX",
                        "av_no": "11J411E",
                        "iframe_path": "https://player.bilibili.com/player.html?xxx=xxx",
                        "duration": 97,
                        "title": "Title",
                        "pic": "https://**/lc01gi.jpg"
                    }
                ],
              "attachments": null,
                //æ–‡ä»¶
//                "attachments": {
//                    "type": "file",
//                    "url": "https://chuanyuapp.oss-cn-qingdao.aliyuncs.com/attachments/2021-08/06/610cd0a9af28c.txt",
//                    "name": "gif.txt",
//                    "file_type": "text/plain",
//                    "size": 540579
//                },
                //è§†é¢‘
                // "attachments": {
                //     "type": "video",
                //     "url": "https://chuanyuapp.oss-cn-qingdao.aliyuncs.com/attachments/2021-08/06/610cd8196e620.mp4",
                //     "name": "76b79357ab7c8ec9c08c13b641ebf660.mp4",
                //     "duration": 15.472,
                //     "size": 2575670,
                //     "width": 480,
                //     "height": 960
                // },
                "create_at": 1612685332518,
                "updated_at": 0,
                "reactions": [
                    {
                        "emoji": {
                            "id": "[#129315;]",
                            "name": "[#129315;]"
                        },
                        "count": 1,
                        "me": true
                    }
                ],
                "author": {
                    "id": "1780328444",
                    "username": "å°åš",
                    "online": false,
                    "avatar": "https://***.jpg"
                },
                "image_name": "",
                "read_status": false,
                "quote": null,
              //å¼•ç”¨æ¶ˆæ¯
//                "quote": {
//                    "id": "1c4532f6-10c6-4151-93e9-6347f410f91c",
//                    "type": 1,
//                    "content": "638a0b4a-7742-4bcf-a715-d3bb9c2c7643",
//                    "create_at": 1628069285358,
//                    "author": {
//                        "id": "3080879348",
//                        "username": "ç›– ä¼¦88888",
//                        "identify_num": "5210",
//                        "online": true,
//                        "os": "Websocket",
//                        "status": 1,
//                        "avatar": "https://chuanyuapp.oss-cn-qingdao.aliyuncs.com/avatars/2021-06/89qtG4X7AE046046.gif/icon",
//                        "vip_avatar": "https://chuanyuapp.oss-cn-qingdao.aliyuncs.com/avatars/2021-06/89qtG4X7AE046046.gif?x-oss-process=image/format,jpg",
//                        "nickname": "Mr ğŸ¦¢11377",
//                        "roles": [
//                            102,
//                            816
//                        ],
//                        "is_vip": false,
//                        "bot": false,
//                        "mobile_verified": true,
//                        "joined_at": 1573816459000,
//                        "active_time": 1628229821490
//                    }
//                },
                "mention_info": {
                    "mention_part": [
                        {
                            "id": "28444",
                            "username": "**",
                            "full_name": "**#49",
                            "avatar": "***.jpg"
                        }
                    ],
                    "mention_role_part": [
                        {
                            "role_id": 702,
                            "name": "ç®¡ç†å‘˜",
                            "color": 0,
                            "position": 1,
                            "hoist": 0,
                            "mentionable": 0,
                            "permissions": 1
                        }
                    ]
                }
            }
        ]
    }
}
```

## å‘é€é¢‘é“èŠå¤©æ¶ˆæ¯

### æ¥å£è¯´æ˜

æ­¤æ¥å£ä¸é¢‘é“ç›¸å…³æ¥å£ä¸‹çš„ [å‘é€é¢‘é“èŠå¤©æ¶ˆæ¯](https://developer.kaiheila.cn/doc/http/channel#%E5%8F%91%E9%80%81%E9%A2%91%E9%81%93%E8%81%8A%E5%A4%A9%E6%B6%88%E6%81%AF) åŠŸèƒ½ç›¸åŒã€‚

**æ³¨æ„ï¼š** å¼ºåˆ—å»ºè®®è¿‡æ»¤æ‰æœºå™¨äººå‘é€çš„æ¶ˆæ¯ï¼Œå†è¿›è¡Œå›åº”ã€‚å¦åˆ™ä¼šå¾ˆå®¹æ˜“å½¢æˆä¸¤ä¸ªæœºå™¨äººå¾ªç¯è‡ªè¨€è‡ªè¯­å¯¼è‡´å‘é€é‡è¿‡å¤§ï¼Œè¿›è€Œå¯¼è‡´æœºå™¨äººè¢«å°ç¦ã€‚å¦‚æœç¡®å®éœ€è¦æœºå™¨äººè”åŠ¨çš„æƒ…å†µï¼Œæ…é‡è¿›è¡Œå¤„ç†ï¼Œé˜²æ­¢å½¢æˆå¾ªç¯ã€‚

|åœ°å€|è¯·æ±‚æ–¹å¼|è¯´æ˜|
|--|--|--|
|`/api/v3/message/create`|POST| |

### å‚æ•°åˆ—è¡¨

| å‚æ•°å     | ç±»å‹ | å¿…ä¼  | å‚æ•°åŒºåŸŸ | è¯´æ˜                                              |
| ---------- | ---- | ---- | -------  | ------------------------------------------------- |
| type | int  | å¦    | POST | æ¶ˆæ¯ç±»å‹, è§[type], ä¸ä¼ é»˜è®¤ä¸º `1`, ä»£è¡¨æ–‡æœ¬ç±»å‹ã€‚`2` å›¾ç‰‡æ¶ˆæ¯ï¼Œ`3` è§†é¢‘æ¶ˆæ¯ï¼Œ`4` æ–‡ä»¶æ¶ˆæ¯ï¼Œ`9` ä»£è¡¨ [kmarkdown](https://developer.kaiheila.cn/doc/kmarkdown) æ¶ˆæ¯, `10` ä»£è¡¨[å¡ç‰‡æ¶ˆæ¯](https://developer.kaiheila.cn/doc/cardmessage)ã€‚|
| target_id | string  | æ˜¯    | POST | ç›®æ ‡é¢‘é“ id                                        |
| content    | string  | æ˜¯   | POST | æ¶ˆæ¯å†…å®¹                                          |
| quote    | string  | å¦   | POST | å›å¤æŸæ¡æ¶ˆæ¯çš„ `msgId`                                          |
| nonce      | string  | å¦    | POST | nonce, æœåŠ¡ç«¯ä¸åšå¤„ç†, åŸæ ·è¿”å›                   |
|temp_target_id|string|å¦|POST|ç”¨æˆ·id,å¦‚æœä¼ äº†ï¼Œä»£è¡¨è¯¥æ¶ˆæ¯æ˜¯ä¸´æ—¶æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯ä¸ä¼šå­˜æ•°æ®åº“ï¼Œä½†æ˜¯ä¼šåœ¨é¢‘é“å†…åªç»™è¯¥ç”¨æˆ·æ¨é€ä¸´æ—¶æ¶ˆæ¯ã€‚ç”¨äºåœ¨é¢‘é“å†…é’ˆå¯¹ç”¨æˆ·çš„æ“ä½œè¿›è¡Œå•ç‹¬çš„å›åº”é€šçŸ¥ç­‰ã€‚|

### è¿”å›å‚æ•°è¯´æ˜

| å‚æ•°å   | ç±»å‹         | è¯´æ˜                                                         |
| -------- | ------------ | ------------------------------------------------------------ |
| msg_id | string       | æœåŠ¡ç«¯ç”Ÿæˆçš„æ¶ˆæ¯ id                                       |
| msg_timestamp | int          | æ¶ˆæ¯å‘é€æ—¶é—´(æœåŠ¡å™¨æ—¶é—´æˆ³)                                          |
| nonce | string |éšæœºå­—ç¬¦ä¸²ï¼Œè§å‚æ•°åˆ—è¡¨ |

### è¿”å›ç¤ºä¾‹

```javascript
{
    "code": 0,
    "message": "æ“ä½œæˆåŠŸ",
    "data": {
        "msg_id": "50974c-364c983fa6cb",
        "msg_timestamp": 1607072537177,
        "nonce": "xxxx"
    }
}
```

## æ›´æ–°é¢‘é“èŠå¤©æ¶ˆæ¯

### æ¥å£è¯´æ˜

ç›®å‰æ”¯æŒæ¶ˆæ¯ `type `ä¸º `9ã€10` çš„ä¿®æ”¹ï¼Œå³ KMarkdown å’Œ CardMessage

|åœ°å€|è¯·æ±‚æ–¹å¼|è¯´æ˜|
|--|--|--|
|`/api/v3/message/update`|POST| |

### å‚æ•°åˆ—è¡¨

| å‚æ•°å     | ç±»å‹ | å¿…ä¼  | å‚æ•°åŒºåŸŸ | è¯´æ˜                                              |
| ---------- | ---- | ---- | -------  | ------------------------------------------------- |
| msg_id | string | æ˜¯   | POST | æ¶ˆæ¯ id |
| content    | string  | æ˜¯   | POST | æ¶ˆæ¯å†…å®¹                                          |
| quote    | string  | å¦   | POST | å›å¤æŸæ¡æ¶ˆæ¯çš„ `msgId`ã€‚å¦‚æœä¸ºç©ºï¼Œåˆ™ä»£è¡¨åˆ é™¤å›å¤ï¼Œä¸ä¼ åˆ™æ— å½±å“ã€‚                  |
| temp_target_id    | string  | å¦   | POST | ç”¨æˆ· idï¼Œé’ˆå¯¹ç‰¹å®šç”¨æˆ·ä¸´æ—¶æ›´æ–°æ¶ˆæ¯ï¼Œå¿…é¡»æ˜¯æ­£å¸¸æ¶ˆæ¯æ‰èƒ½æ›´æ–°ã€‚ä¸å‘é€ä¸´æ—¶æ¶ˆæ¯æ¦‚å¿µä¸åŒï¼Œä½†åŒæ ·ä¸ä¿å­˜æ•°æ®åº“ã€‚                 |

### è¿”å›å‚æ•°è¯´æ˜

æ— è¿”å›å‚æ•°

### è¿”å›ç¤ºä¾‹

```javascript
{
    "code": 0,
    "message": "æ“ä½œæˆåŠŸ",
    "data": []
}
```

## åˆ é™¤é¢‘é“èŠå¤©æ¶ˆæ¯

### æ¥å£è¯´æ˜

æ™®é€šç”¨æˆ·åªèƒ½åˆ é™¤è‡ªå·±çš„æ¶ˆæ¯ï¼Œæœ‰æƒé™çš„ç”¨æˆ·å¯ä»¥åˆ é™¤æƒé™èŒƒå›´å†…ä»–äººçš„æ¶ˆæ¯ã€‚

| åœ°å€                     | è¯·æ±‚æ–¹å¼ | è¯´æ˜ |
| ------------------------ | -------- | ---- |
| `/api/v3/message/delete` | POST     |      |

### å‚æ•°åˆ—è¡¨

| å‚æ•°å  | ç±»å‹   | å¿…ä¼  | å‚æ•°åŒºåŸŸ | è¯´æ˜                                                         |
| ------- | ------ | ---- | -------- | ------------------------------------------------------------ |
| msg_id  | string | æ˜¯   | POST     | æ¶ˆæ¯ id                                                      |

### è¿”å›å‚æ•°è¯´æ˜

æ— è¿”å›å‚æ•°

### è¿”å›ç¤ºä¾‹

```javascript
{
    "code": 0,
    "message": "æ“ä½œæˆåŠŸ",
    "data": []
}
```

## è·å–é¢‘é“æ¶ˆæ¯æŸå›åº”çš„ç”¨æˆ·åˆ—è¡¨ 

### æ¥å£è¯´æ˜
|åœ°å€|è¯·æ±‚æ–¹å¼|è¯´æ˜|
|--|--|--|
|`/api/v3/message/reaction-list`|GET| |

### å‚æ•°åˆ—è¡¨

| å‚æ•°å     | ç±»å‹ | å¿…ä¼  | å‚æ•°åŒºåŸŸ | è¯´æ˜                                              |
| ---------- | ---- | ---- | -------  | ------------------------------------------------- |
| msg_id | string  | æ˜¯    | GET |é¢‘é“æ¶ˆæ¯çš„id|
| emoji |string|æ˜¯|GET| emojiçš„id, å¯ä»¥ä¸ºGuilEmojiæˆ–è€…Emoji, æ³¨æ„ï¼šåœ¨getä¸­ï¼Œåº”è¯¥è¿›è¡Œurlencode|

### è¿”å›å‚æ•°è¯´æ˜

è¿”å›çš„æ˜¯ç”¨æˆ·çš„åˆ—è¡¨ï¼Œå‚æ•°å¦‚ä¸‹ï¼š

| å‚æ•°å   | ç±»å‹         | è¯´æ˜                                                         |
| -------- | ------------ | ------------------------------------------------------------ |
| id | string       |   ç”¨æˆ·çš„id                                    |
|username | string          | ç”¨æˆ·çš„åç§°                                         |
|nickname | string          | ç”¨æˆ·åœ¨æœåŠ¡å™¨å†…çš„å‘¢ç§°                               |
|identify_num | string |ç”¨æˆ·åçš„è®¤è¯æ•°å­—ï¼Œç”¨æˆ·åæ­£å¸¸ä¸ºï¼šuser_name#identify_num |
|online| boolean| å½“å‰æ˜¯å¦åœ¨çº¿|
|status|int|ç”¨æˆ·çš„çŠ¶æ€, 0ä»£è¡¨æ­£å¸¸ï¼Œ10ä»£è¡¨è¢«å°ç¦|
|avatar|string|ç”¨æˆ·çš„å¤´åƒçš„urlåœ°å€|
|bot|boolean|ç”¨æˆ·æ˜¯å¦ä¸ºæœºå™¨äºº|
|reaction_time|intval|ç”¨æˆ·ç‚¹å‡»reactionçš„æ¯«ç§’æ—¶é—´æˆ³|

### è¿”å›ç¤ºä¾‹

```javascript
{
    "code": 0,
    "message": "æ“ä½œæˆåŠŸ",
    "data": {
        {
            "id": "xxxx",
            "username": "test",
            "identify_num": "xxx",
            "online": false,
            "status": 0,
            "avatar": "xxxx",
            "bot": true,
            "tag_info": {
                "color": "#34A853",
                "text": "æœºå™¨äºº"
            },
            "nickname": "xxxx",
            "reaction_time": 1612323994414
        } 
    }
}
```

## ç»™æŸä¸ªæ¶ˆæ¯æ·»åŠ å›åº” 

### æ¥å£è¯´æ˜
|åœ°å€|è¯·æ±‚æ–¹å¼|è¯´æ˜|
|--|--|--|
|`/api/v3/message/add-reaction`|POST| |

### å‚æ•°åˆ—è¡¨

| å‚æ•°å     | ç±»å‹ | å¿…ä¼  | å‚æ•°åŒºåŸŸ | è¯´æ˜                                              |
| ---------- | ---- | ---- | -------  | ------------------------------------------------- |
| msg_id | string  | æ˜¯    | POST |é¢‘é“æ¶ˆæ¯çš„id|
| emoji |string|æ˜¯|POST| emojiçš„id, å¯ä»¥ä¸ºGuilEmojiæˆ–è€…Emoji|

### è¿”å›å‚æ•°è¯´æ˜

æ— è¿”å›å‚æ•°

### è¿”å›ç¤ºä¾‹

```javascript
{
    "code": 0,
    "message": "æ“ä½œæˆåŠŸ",
    "data": []
}
```

## åˆ é™¤æ¶ˆæ¯çš„æŸä¸ªå›åº”

### æ¥å£è¯´æ˜
|åœ°å€|è¯·æ±‚æ–¹å¼|è¯´æ˜|
|--|--|--|
|`/api/v3/message/delete-reaction`|POST| |

### å‚æ•°åˆ—è¡¨

| å‚æ•°å     | ç±»å‹ | å¿…ä¼  | å‚æ•°åŒºåŸŸ | è¯´æ˜                                              |
| ---------- | ---- | ---- | -------  | ------------------------------------------------- |
| msg_id | string  | æ˜¯    | POST |é¢‘é“æ¶ˆæ¯çš„id|
| emoji |string|æ˜¯|POST| emojiçš„id, å¯ä»¥ä¸ºGuilEmojiæˆ–è€…Emoji|
| user_id| string| å¦| POST| ç”¨æˆ·çš„id, å¦‚æœä¸å¡«åˆ™ä¸ºè‡ªå·±çš„idã€‚åˆ é™¤åˆ«äººçš„reactionéœ€è¦æœ‰ç®¡ç†é¢‘é“æ¶ˆæ¯çš„æƒé™ |

### è¿”å›å‚æ•°è¯´æ˜

æ— è¿”å›å‚æ•°

### è¿”å›ç¤ºä¾‹

```javascript
{
    "code": 0,
    "message": "æ“ä½œæˆåŠŸ",
    "data": []
}
```
